generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String         @id @default(cuid())
  name            String
  email           String         @unique
  hashedPassword  String
  avatarUrl       String?
  bio             String?
  isAdmin         Boolean        @default(false)
  preferences     Json?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  recipes         Recipe[]
  savedRecipes    SavedRecipe[]
  uploads         Upload[]
  comments        Comment[]
  userBadges      UserBadge[]
  aiSessions      AISession[]
  
  @@map("users")
}

model Meat {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  imageUrl    String
  safeTemp    Int
  tips        String[]
  commonMistakes String[]
  
  recipes     Recipe[]
  
  @@map("meats")
}

model Recipe {
  id              String         @id @default(cuid())
  title           String
  meatId          String
  authorId        String
  serves          Int
  prepTime        Int
  cookTime        Int
  difficulty      String
  ingredients     Json
  nutrition       Json?
  stockPhotoUrl   String?
  approved        Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  meat            Meat           @relation(fields: [meatId], references: [id])
  author          User           @relation(fields: [authorId], references: [id])
  steps           RecipeStep[]
  savedBy         SavedRecipe[]
  comments        Comment[]
  
  @@map("recipes")
}

model RecipeStep {
  id                    String  @id @default(cuid())
  recipeId              String
  stepNumber            Int
  description           String
  timerSeconds          Int?
  temperatureCheckpoint Int?
  
  recipe                Recipe  @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  
  @@map("recipe_steps")
}

model SavedRecipe {
  id              String   @id @default(cuid())
  userId          String
  recipeId        String
  notes           String?
  aiNotesEnabled  Boolean  @default(true)
  createdAt       DateTime @default(now())
  
  user            User     @relation(fields: [userId], references: [id])
  recipe          Recipe   @relation(fields: [recipeId], references: [id])
  
  @@unique([userId, recipeId])
  @@map("saved_recipes")
}

model Upload {
  id          String   @id @default(cuid())
  userId      String
  filename    String
  url         String
  type        String
  createdAt   DateTime @default(now())
  
  user        User     @relation(fields: [userId], references: [id])
  
  @@map("uploads")
}

model Comment {
  id              String    @id @default(cuid())
  userId          String
  recipeId        String
  body            String
  parentCommentId String?
  flagged         Boolean   @default(false)
  createdAt       DateTime  @default(now())
  
  user            User      @relation(fields: [userId], references: [id])
  recipe          Recipe    @relation(fields: [recipeId], references: [id])
  parentComment   Comment?  @relation("CommentReplies", fields: [parentCommentId], references: [id])
  replies         Comment[] @relation("CommentReplies")
  
  @@map("comments")
}

model Badge {
  id          String      @id @default(cuid())
  name        String      @unique
  description String
  iconUrl     String
  
  userBadges  UserBadge[]
  
  @@map("badges")
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  badgeId   String
  awardedAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id])
  badge     Badge    @relation(fields: [badgeId], references: [id])
  
  @@unique([userId, badgeId])
  @@map("user_badges")
}

model AISession {
  id                String   @id @default(cuid())
  userId            String
  sessionData       Json
  lastInteractionAt DateTime @default(now())
  
  user              User     @relation(fields: [userId], references: [id])
  
  @@map("ai_sessions")
}

model Personality {
  id            String   @id @default(cuid())
  name          String   @unique
  promptTemplate String
  toneTags      String[]
  imageUrl      String
  defaultFor    String?
  
  @@map("personalities")
}

model Challenge {
  id          String   @id @default(cuid())
  title       String
  description String
  month       DateTime
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  @@map("challenges")
}
